let myMap,sel,myLayout,myCanvas,pointName,mapName,setItv,pathChang,img,agv1,imgMap,iTextX,iTextY,x1,x2,y1,y2,x3,y3,x4,y4,x02,y02,nameLine,dataUpdateLine,layoutMap=$.ajax({method:"get",url:window.location.origin+"/agv-control/layout",cache:!1,async:!1,data:{},dataType:"json"}),set=!1,setLinePoint=!1,setLinePoint1=!1,ID=0,ratio=w=h=1,tox=toy=0,zoom=.01,allImg=[],rectPoint=[],rectMap=[],lineMap=[],pointList=[],lineList=[],sumRatio=[],data1=[],dataName=[],selectLine=[],temporary=[],agv=[],agv0=[],lineMove=[],linePointMove=[],lineAgv=[],newLine=[],colorLine=[],lineHide=[],position=0,x01=y01=0,IBN=ZBH=xI1=yI1=yH1=xH1=0,mX=mY=0,widthImg=width0=$("#myCanvan").width(),heightWin=height0=$(window).height()-290+30,statusConfig=statusWidth=load_map=!1,l=0,widthOld=$("#my-card").width(),time=2e3,checkTime=0;function preload(){layoutMap.done(function(e){let t=0;for(t=0;t<e.data.length;t++)allImg[e.data[t].ID]=loadImage(e.data[t].Image)}),agv1=loadImage("/dist/img/agv1-2.png")}function setup(){select("#btnConfig").mousePressed(configMap),select("#maximize").mousePressed(resetWidth),(sel=select("#layoutAgv")).changed(loadMap),loadMap()}function configMap(){statusConfig=!statusConfig,imgTheme.resetLine(),imgTheme.resetMap(),imgTheme.resetPoint(),imgTheme.pointStatus=!1,setIn()}function loadMap(){history.pushState(0,0,"/agv-control/select/"+$("#layoutAgv").val()),"0"==$("#layoutAgv").val()?(myCanva=createCanvas($("#myCanvas").width,heightWin),myCanva.parent("myCanvas"),load_map=!1,$("#btnConfig").hide(),setIn()):(widthImg=width0=$("#myCanvan").width(),heightWin=height0=$(window).height()-290+30,$(".sele").hide(),$(".my-sel"+$("#layoutAgv").val()).show(),$("#modalLoad").modal(),load_map=!0,$("#btnConfig").show(),imgMap=new ImgMap(allImg[$("#layoutAgv").val()],1,1,allImg[$("#layoutAgv").val()].width,allImg[$("#layoutAgv").val()].height),myCanva=createCanvas(widthImg-2,heightWin),myCanva.parent("myCanvas"),imgTheme=new ImgTheme(Number(widthImg)-50),loadData(),layout(),loadImgAgv(),loadPoint($("#layoutAgv").val()),setIn(),$("#display").height($("#my-card").height()),$("#cardMess").height("100%"))}function setIn(){clearTimeout(setItv),setItv=setTimeout(loadImgAgv,time)}function resetWidth(){statusWidth=!statusWidth,imgTheme.resetLine(),imgTheme.resetMap(),imgTheme.resetPoint(),imgTheme.resetLinePoint(),statusConfig=!1,statusWidth?($("#btnConfig").hide(),$("#display").hide(),setTimeout(function(){widthImg=$(window).width()-40,heightWin=$(window).height()-100,resizeCanvas(widthImg-2,heightWin),imgTheme.x=Number(widthImg)-50},500)):($("#btnConfig").show(),$("#display").show(),setTimeout(function(){widthImg=width0,heightWin=height0,resizeCanvas(widthImg-2,heightWin),imgTheme.x=Number(widthImg)-50},500))}function loadImgAgv(){if(keyIsDown(90)||statusConfig)setIn();else{let e=0;pin($("#layoutAgv").val()).done(function(t){setIn(),newLine=[],colorLine=[],l=0,lineMove=[],agv=[],lineAgv=[],e=t.data.length,$(".display-agv").hide();for(let o of t.data){$("#card-display"+o.AGV_ID).show();let t=(100*(Number(o.Battery)-210)/45).toFixed(1),a=(Number(o.Response_time)-150)/.5,i=-Number(o.Angle)*PI/180;if($("#textAgv"+o.AGV_ID).css("color","#"+o.Color),$("#battery"+o.AGV_ID).text(t+"%"),$("#battery"+o.AGV_ID).css("text-align","center"),$("#wifi"+o.AGV_ID).width(a+"%"),$("#wifi"+o.AGV_ID).text(a+"%"),$("#wifi"+o.AGV_ID).css("color","black"),$("#statusAgv"+o.AGV_ID).text(o.Status),0!=o.stt_per&&null!=o.stt_per?($(".errPerfom"+o.AGV_ID).show(),$(".errPerfom"+o.AGV_ID).text(o.Perform_error),$(".errPerfom"+o.AGV_ID).addClass("btn-outline-danger"),$(".errPerfom"+o.AGV_ID).removeClass("btn-danger"),setTimeout(function(){$(".errPerfom"+o.AGV_ID).removeClass("btn-outline-danger"),$(".errPerfom"+o.AGV_ID).addClass("btn-danger")},1e3)):$(".errPerfom"+o.AGV_ID).hide(),0!=o.stt_move&&null!=o.stt_move?($(".errMove"+o.AGV_ID).show(),$(".errMove"+o.AGV_ID).text(o.Move_error),$(".errMove"+o.AGV_ID).addClass("btn-outline-danger"),$(".errMove"+o.AGV_ID).removeClass("btn-danger"),setTimeout(function(){$(".errMove"+o.AGV_ID).removeClass("btn-outline-danger"),$(".errMove"+o.AGV_ID).addClass("btn-danger")},1e3)):$(".errMove"+o.AGV_ID).hide(),0!=o.stt_device&&null!=o.stt_device?($(".errDevice"+o.AGV_ID).show(),$(".errDevice"+o.AGV_ID).text(o.Device_error),$(".errDevice"+o.AGV_ID).addClass("btn-outline-danger"),$(".errDevice"+o.AGV_ID).removeClass("btn-danger"),setTimeout(function(){$(".errDevice"+o.AGV_ID).removeClass("btn-outline-danger"),$(".errDevice"+o.AGV_ID).addClass("btn-danger")},1e3)):$(".errDevice"+o.AGV_ID).hide(),1==o.stt_task?($(".task"+o.AGV_ID).show(),$(".noTask"+o.AGV_ID).hide()):($(".noTask"+o.AGV_ID).show(),$(".noTask"+o.AGV_ID).text(o.TASK),$(".task"+o.AGV_ID).hide()),$(".status-info"+o.AGV_ID).text(o.STATUS),0==o.stt_agv?($(".status-info"+o.AGV_ID).removeClass("btn-outline-danger"),$(".status-info"+o.AGV_ID).addClass("btn-outline-success")):($(".status-info"+o.AGV_ID).addClass("btn-outline-danger"),$(".status-info"+o.AGV_ID).removeClass("btn-outline-success")),$("#positionAgv"+o.AGV_ID).text(o.Position),$("#card-display"+o.AGV_ID).css("border","2px solid #"+o.Color),$("#textAgv1"+o.AGV_ID).css("color","#"+o.Color),$("#battery1"+o.AGV_ID).text(t+"%"),$("#battery1"+o.AGV_ID).css("text-align","center"),$("#wifi1"+o.AGV_ID).width(a+"%"),$("#wifi1"+o.AGV_ID).text(a+"%"),$("#wifi1"+o.AGV_ID).css("color","black"),$("#statusAgv1"+o.AGV_ID).text(o.Status),$("#modeAgv1"+o.AGV_ID).text(o.Mode),$("#positionAgv1"+o.AGV_ID).text(o.Position),t<=25?t<=0?($("#battery"+o.AGV_ID).text("0%"),$("#battery1"+o.AGV_ID).text("0%"),$("#battery"+o.AGV_ID).css("box-shadow","inset 5rem 0 0 #f56954"),$("#battery1"+o.AGV_ID).css("box-shadow","inset 5rem 0 0 #f56954")):($("#battery"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #f56954"),$("#battery1"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #f56954")):t>=50?($("#battery"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #64C92A"),$("#battery1"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #64C92A"),t>100&&($("#battery"+o.AGV_ID).text("100%"),$("#battery1"+o.AGV_ID).text("100%"))):($("#battery"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #FFD700"),$("#battery1"+o.AGV_ID).css("box-shadow","inset "+4*t/100+"rem 0 0 #FFD700")),a<="25"?($("#wifi"+o.AGV_ID).css("background-color","#"),$("#wifi1"+o.AGV_ID).css("background-color","#f56954"),a<"0"&&($("#wifi"+o.AGV_ID).text("0%"),$("#wifi1"+o.AGV_ID).text("0%"))):a>="50"?($("#wifi"+o.AGV_ID).css("background-color","#1CA45C"),$("#wifi1"+o.AGV_ID).css("background-color","#1CA45C"),a>100&&($("#wifi"+o.AGV_ID).text("100%"),$("#wifi1"+o.AGV_ID).text("100%"))):($("#wifi"+o.AGV_ID).css("background-color","#FFD700"),$("#wifi1"+o.AGV_ID).css("background-color","#FFD700")),load_map){if(null!=o.Path){let e=o.Path.split(" ");for(let t of e){let e=t.split("-");e.push(o.Color),lineAgv.push(e);for(let t of e)-1==lineMove.indexOf(t)&&lineMove.push(t)}}let e=o.Path.split(" ");for(let t of e){let e=t.split("-");e.push(o.Color),lineAgv.push(e);for(let t of e)-1==lineMove.indexOf(t)&&lineMove.push(t)}imgAgv=new ImgAgv(agv1,o.AGV_ID,Number(o.X),Number(o.Y),25,25,o.Color,i),agv.push(imgAgv)}e--}if(0==e&&load_map)if(0==agv0.length||agv0.length!=agv.length)agv0=agv;else for(let e=0;e<agv0.length;e++)agv[e].x!=agv0[e].x0||agv[e].y!=agv0[e].y0?(agv0[e].run=!0,agv0[e].stepX=agv[e].x,agv0[e].stepY=agv[e].y,agv0[e].check1=agv0[e].check2=agv0[e].check3=agv0[e].check4=!1,agv0[e].updateNew(agv[e].x,agv[e].y,agv[e].w,agv[e].h,agv[e].color,agv[e].angle),checkTime=0):agv[e].angle!=agv0[e].angle||agv[e].w!=agv0[e].w||agv[e].h!=agv0[e].h||agv[e].color!=agv0[e].color?(agv0[e].updateNew(agv[e].x,agv[e].y,agv[e].w,agv[e].h,agv[e].color,agv[e].angle),checkTime=0):time=200==++checkTime?1e4:checkTime>=300?3e4:2e3}).fail(function(e){setIn()})}}function loadPoint(e){myPoint=$.ajax({method:"get",url:window.location.origin+"/agv-control/point-list",cache:!1,data:{layout:e},dataType:"json"}),myPoint.done(function(e){pointList=[];for(let t of e.data){temporary=[];let e=new MyPoint(t.ID,Number(t.X),Number(t.Y),Number(t.W),Number(t.H),t.NAME,Number(t.MAPNAME),Number(t.ANGLE),Number(t.OFFSET),Number(t.REV),Number(t.AREA),Number(t.PARTITION),Number(t.AGV_TYPE),Number(t.CODE));if(pointList.push(e),"1"==t.ANGLE&&(x1=Number(t.X),y1=Number(t.Y)+Number(t.Z)/2,x2=Number(t.X_MAP),y2=Number(t.Y_MAP)-Number(t.Z)/2,int(dist(x1,y1,x2,y2))>Number(t.Z))){calculateAngle(x1,y1,x2,y2),temporary.push(xI1,yI1,xH1,yH1),calculateAngle(x2,y2,x1,y1);let e=new LineMap(x1,y1,x2,y2,temporary[0],temporary[1],temporary[2],temporary[3],t.NAME+"P","N13",t.MAPNAME,xI1,yI1,xH1,yH1);lineMap.push(e)}if("4"==t.ANGLE&&(x1=Number(t.X)+Number(t.Z)/2,y1=Number(t.Y),x2=Number(t.X_MAP)-Number(t.Z)/2,y2=Number(t.Y_MAP),int(dist(x1,y1,x2,y2))>Number(t.Z))){calculateAngle(x1,y1,x2,y2),temporary.push(xI1,yI1,xH1,yH1),calculateAngle(x2,y2,x1,y1);let e=new LineMap(x1,y1,x2,y2,temporary[0],temporary[1],temporary[2],temporary[3],t.NAME+"P","N24",t.MAPNAME,xI1,yI1,xH1,yH1);lineMap.push(e)}if("3"==t.ANGLE&&(x1=Number(t.X),y1=Number(t.Y)-Number(t.Z)/2,x2=Number(t.X_MAP),y2=Number(t.Y_MAP)+Number(t.Z)/2,int(dist(x1,y1,x2,y2))>Number(t.Z))){calculateAngle(x1,y1,x2,y2),temporary.push(xI1,yI1,xH1,yH1),calculateAngle(x2,y2,x1,y1);let e=new LineMap(x1,y1,x2,y2,temporary[0],temporary[1],temporary[2],temporary[3],t.NAME+"P","N13",t.MAPNAME,xI1,yI1,xH1,yH1);lineMap.push(e)}if("2"==t.ANGLE&&(x1=Number(t.X)-Number(t.Z)/2,y1=Number(t.Y),x2=Number(t.X_MAP)+Number(t.Z)/2,y2=Number(t.Y_MAP),int(dist(x1,y1,x2,y2))>Number(t.Z))){calculateAngle(x1,y1,x2,y2),temporary.push(xI1,yI1,xH1,yH1),calculateAngle(x2,y2,x1,y1);let e=new LineMap(x1,y1,x2,y2,temporary[0],temporary[1],temporary[2],temporary[3],t.NAME+"P","N24",t.MAPNAME,xI1,yI1,xH1,yH1);lineMap.push(e)}if("1"!=t.ANGLE&&"2"!=t.ANGLE&&"3"!=t.ANGLE&&"4"!=t.ANGLE&&"0"!=t.ANGLE&&(x1=Number(t.X),y1=Number(t.Y),x2=Number(t.X_MAP),y2=Number(t.Y_MAP),int(dist(x1,y1,x2,y2))>Number(t.Z))){calculateAngle(x1,y1,x2,y2),temporary.push(xI1,yI1,xH1,yH1),calculateAngle(x2,y2,x1,y1);let e=new LineHide(x1,y1,x2,y2,temporary[0],temporary[1],temporary[2],temporary[3],t.NAME+"P","N24",t.MAPNAME,xI1,yI1,xH1,yH1);lineHide.push(e)}}$("#modalLoad").modal("hide")}).fail(function(e){console.log(e)})}function layout(){(myLayout=$.ajax({method:"get",url:window.location.origin+"/layout",cache:!1,data:{layout:$("#layoutAgv").val()},dataType:"json"})).done(function(e){ID=e.data.Name,ratio=Number(e.data.Ratio),tox=Number(e.data.X_offset),toy=Number(e.data.Y_offset)})}function loadData(){(myMap=$.ajax({method:"get",url:window.location.origin+"/agv-control/map",cache:!1,data:{layout:$("#layoutAgv").val()},dataType:"json"})).done(function(e){rectMap=[],lineMap=[],lineHide=[],position=0;for(let t of e.data){let e=Number(t.X),o=Number(t.Y),a=Number(t.Z),i=t.NAME,n=t.CODE,r=t.N1,l=t.N2,d=t.N3,s=t.N4,m=t.N5,c=t.N0,u=Number(t.X_LIDA),g=Number(t.Y_LIDA),h=Number(t.X_NAV),$=Number(t.Y_NAV),N=t.Layout;if(1==i.length?(iTextX=.65,iTextY=.8):2==i.length?(iTextX=1.25,iTextY=.8):3==i.length?(iTextX=1.85,iTextY=.8):(iTextX=2.3,iTextY=.8),test=new PointMap(e,o,a,i,iTextX,iTextY,n,r,l,d,s,m,c,position,u,g,h,$,N),rectMap.push(test),0!=t.N1){x1=Number(e),y1=Number(o)-Number(a)/2,x2=Number(t.X_1),y2=Number(t.Y_1)+Number(t.Z_1)/2,calculateAngle(x1,y1,x2,y2);let n=t.N1;myLine=new LineMap(x1,y1,x2,y2,xI1,yI1,xH1,yH1,i,"N1",n,0,0,0,0),lineMap.push(myLine)}if(0!=t.N4){x1=Number(e)-Number(a)/2,y1=Number(o),x2=Number(t.X_4)+Number(t.Z_4)/2,y2=Number(t.Y_4),calculateAngle(x1,y1,x2,y2);let n=t.N4;myLine=new LineMap(x1,y1,x2,y2,xI1,yI1,xH1,yH1,i,"N4",n,0,0,0,0),lineMap.push(myLine)}if(0!=t.N3){x1=Number(e),y1=Number(o)+Number(a)/2,x2=Number(t.X_3),y2=Number(t.Y_3)-Number(t.Z_3)/2,calculateAngle(x1,y1,x2,y2);let n=t.N3;myLine=new LineMap(x1,y1,x2,y2,xI1,yI1,xH1,yH1,i,"N3",n,0,0,0,0),lineMap.push(myLine)}if(0!=t.N2){x1=Number(e)+Number(a)/2,y1=Number(o),x2=Number(t.X_2)-Number(t.Z_2)/2,y2=Number(t.Y_2),calculateAngle(x1,y1,x2,y2);let n=t.N2;myLine=new LineMap(x1,y1,x2,y2,xI1,yI1,xH1,yH1,i,"N2",n,0,0,0,0),lineMap.push(myLine)}}})}function calculateAngle(e,t,o,a){IBN=atan(abs(e-o)/abs(t-a))-PI/6,ZBH=atan(abs(t-a)/abs(o-e))-PI/6,e<=o&&t>a&&(xI1=2*-sin(IBN)+o,yI1=2*cos(IBN)+a,yH1=2*sin(ZBH)+a,xH1=2*-cos(ZBH)+o),e>=o&&t<a&&(xI1=2*sin(IBN)+o,yI1=2*-cos(IBN)+a,yH1=2*-sin(ZBH)+a,xH1=2*cos(ZBH)+o),e>o&&t>=a&&(xI1=2*sin(IBN)+o,yI1=2*cos(IBN)+a,yH1=2*sin(ZBH)+a,xH1=2*cos(ZBH)+o),e<o&&t<=a&&(xI1=2*-sin(IBN)+o,yI1=2*-cos(IBN)+a,yH1=2*-sin(ZBH)+a,xH1=2*-cos(ZBH)+o)}function draw(){if(load_map){let e=$("#my-card").width(),t=$(window).height()-290+30;if(t!=heightWin&&(widthOld=e,heightWin=t,loadMap()),$("#rat").text("Tỷ lệ : "+ratio.toFixed(1)+" - tox : "+tox.toFixed(0)+" - toy : "+toy.toFixed(0)),background(220),imgMap.caculateXY(ratio,tox,toy),imgMap.createImg(ratio),imgTheme.drawElip(ratio),imgTheme.addPoint&&imgTheme.drawRect(ratio),statusConfig){set=!1;for(let e of rectMap)if(!e.statusPoint()){set=!0;break}for(let e of lineMap)if(e.point){set=!0;break}}for(let e of lineHide)statusConfig?(e.createLine(ratio,tox,toy),e.editColor("000000")):(e.createLine(ratio,tox,toy),e.editColor("C0C0C0"));for(let e of pointList)e.createPoint(ratio,tox,toy),keyIsDown(77)&&e.checkClicked&&statusConfig?e.newPoint(ratio,tox,toy):e.caculateCor(ratio,tox,toy),!e.check||keyIsDown(77)||set||e.createTiniPoint(ratio,tox,toy),2==linePointMove.length&&e.drawLine(ratio,Number(linePointMove[0]),Number(linePointMove[1]),Number(mouseX),Number(mouseY)),4==linePointMove.length&&e.drawLine(ratio,Number(linePointMove[0]),Number(linePointMove[1]),Number(linePointMove[2]),Number(linePointMove[3]));for(let e=0;e<rectMap.length;e++)rectMap[e].status()?(rectMap[e].createMap(ratio,tox,toy),rectMap[e].colorMap(statusConfig),-1==lineMove.indexOf(rectMap[e].name)||statusConfig||rectMap[e].colorMap(!statusConfig)):imgTheme.drawElipNew(ratio,rectMap[e].name,rectMap[e].iTextX,rectMap[e].iTextY,rectMap[e].code,e,rectMap[e].N1,rectMap[e].N2,rectMap[e].N3,rectMap[e].N4,rectMap[e].N5,rectMap[e].N0,rectMap[e].xLida,rectMap[e].yLida,rectMap[e].xNav,rectMap[e].yNav,rectMap[e].layout,rectMap[e].z),rectMap[e].statusPoint()||keyIsDown(77)||!statusConfig||rectMap[e].createPoint(ratio,tox,toy),statusConfig&&imgTheme.lineStatus&&!keyIsDown(90)&&rectMap[e].checkLine&&rectMap[e].setLine&&null!=x02&&null!=y02&&!keyIsDown(77)&&rectMap[e].createNewLine(x01,y01,x02,y02,ratio);for(let e=0;e<lineMap.length;e++){if(statusConfig)lineMap[e].createLine(ratio,tox,toy),lineMap[e].editColor("000000");else if(0!=lineAgv.length){for(let t of lineAgv)for(let o=0;o<t.length;o++)lineMap[e].name==t[o]&&lineMap[e].to==t[o+1]&&null!=t[o+1]&&NaN!=Number(t[o])?0==l&&(newLine.push(lineMap[e]),colorLine.push(t[t.length-1])):(lineMap[e].createLine(ratio,tox,toy),lineMap[e].editColor("C0C0C0"));e==lineMap.length-1&&(l=1)}else lineMap[e].createLine(ratio,tox,toy),lineMap[e].editColor("C0C0C0");lineMap[e].statusPointLine()&&!keyIsDown(77)&&lineMap[e].createPointLine(ratio,tox,toy)}if(statusConfig&&(imgTheme.buttonCreate(),imgTheme.buttonCreateLine(),imgTheme.buttonCreatePoint(),imgTheme.buttonCreateLinePoint(),imgTheme.drawTextMap(),imgTheme.drawTextLineMap(),imgTheme.drawTextPoint(),imgTheme.drawTextLinePoint()),!statusConfig)for(let e=0;e<newLine.length;e++)newLine[e].editColor(colorLine[e]),newLine[e].createLine(ratio,tox,toy);if(!statusConfig)for(let e of agv0)e.drawDirection(ratio,tox,toy),e.createAgv(ratio,tox,toy),e.start()}else background(220),push(),fill("#f56954"),textSize(100),text("Select Layout !",$("#myCanvas").width()/3,heightWin/2),pop()}function mousePressed(){if(load_map&&(imgTheme.checkMap=!0,setLinePoint=!1,setLinePoint1=!1,statusConfig)){for(let e of rectMap)e.resetLine();if(keyIsDown(77))if(imgTheme.pointStatus=!1,set){for(let e of rectMap)e.moveRect(ratio,tox,toy);for(let e of rectMap)e.check||(imgTheme.checkMap=!1)}else for(let e of pointList)e.clickedOldPoint(ratio),e.checkClicked&&(imgTheme.statusPoint(),imgTheme.lineStatus=!1,imgTheme.checkMap=!1);if(imgTheme.lineStatus){data1=[];for(let e of rectMap)e.setNewLine(ratio,tox,toy);for(let e of rectMap)0==dataName.length&&0==data1.length&&!keyIsDown(90)&&e.checkLine&&(nameLine="",data1.push(mouseX,mouseY),x01=Number(data1[0]),y01=Number(data1[1]),int(dist((x01-tox)/ratio,(y01-toy)/ratio,e.x,e.y-e.z/2))<e.z/5?nameLine="N1":int(dist((x01-tox)/ratio,(y01-toy)/ratio,e.x+e.z/2,e.y))<e.z/5?nameLine="N2":int(dist((x01-tox)/ratio,(y01-toy)/ratio,e.x,e.y+e.z/2))<e.z/5?nameLine="N3":int(dist((x01-tox)/ratio,(y01-toy)/ratio,e.x-e.z/2,e.y))<e.z/5&&(nameLine="N4"),""!=nameLine&&dataName.push(e.name,nameLine))}if(mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=124&&mouseY<=168&&(imgTheme.resetLine(),imgTheme.resetPoint(),imgTheme.resetMap(),imgTheme.statusLinePoint()),imgTheme.linePoint&&!keyIsDown(90)&&!keyIsDown(77)){linePointMove=[];for(let e of pointList)e.check&&0==linePointMove.length&&(setLinePoint1=!0,linePointMove.push(e.cordX,e.cordY),pointName=e.name);for(let e of rectMap)e.point||0!=linePointMove.length||(setLinePoint=!0,linePointMove.push(mouseX,mouseY),mapName=e.name,x02=Number(linePointMove[0]),y02=Number(linePointMove[1]),int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x,e.y-e.z/2))<e.z/5?nameLine="N1":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x+e.z/2,e.y))<e.z/5?nameLine="N2":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x,e.y+e.z/2))<e.z/5?nameLine="N3":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x-e.z/2,e.y))<e.z/5&&(nameLine="N4"))}}}function mouseReleased(){if(statusConfig&&load_map){if(imgTheme.lineStatus&&set&&!keyIsDown(77))for(let e of rectMap){let t=int(dist(e.x*ratio+tox,e.y*ratio+toy,mouseX,mouseY));if(!keyIsDown(90)&&t<=e.z/2+2*e.z/4&&e.setLine){2==dataName.length&&e.name!=dataName[0]&&(e.setNewLine1(),dataName.push(e.name)),3==dataName.length&&($("#modalCreateLine").modal({backdrop:"static",keyboard:!1}),$("#requestLine").text("Nối vị trí "+dataName[0]+" hướng "+dataName[1]+" tới vị trí "+dataName[2])),e.setNewLine(ratio,tox,toy);break}}if(imgTheme.pointStatus&&keyIsDown(77))for(let e of pointList)e.checkClicked&&(console.log("set"),e.setPoint(ratio,tox,toy)),e.checkClicked=!1;if(imgTheme.linePoint&&!keyIsDown(70)&&!keyIsDown(90)){if(!setLinePoint1)for(let e of pointList)mouseX>=(e.x-e.w/2)*ratio+tox&&mouseX<=(e.x+e.w/2)*ratio+tox&&mouseY>=(e.y-e.h/2)*ratio+toy&&mouseY<=(e.y+e.h/2)*ratio+toy&&2==linePointMove.length&&(console.log("point"),linePointMove.push(e.cordX,e.cordY),$("#modalCreateLinePoint").modal(),$("#requestLinePoint").text("Bạn Có muốn tạo quan hệ giữa điểm "+mapName+" hướng "+nameLine+" và "+e.name),pointName=e.name);if(!setLinePoint)for(let e of rectMap){let t=int(dist(e.x*ratio+tox,e.y*ratio+toy,mouseX,mouseY));!keyIsDown(90)&&t<=e.z/2*ratio+ratio&&t>=(e.z/2*ratio-ratio).toFixed(0)&&2==linePointMove.length&&(console.log("map"),linePointMove.push(mouseX,mouseY),x02=Number(linePointMove[2]),y02=Number(linePointMove[3]),int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x,e.y-e.z/2))<e.z/5?nameLine="N1":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x+e.z/2,e.y))<e.z/5?nameLine="N2":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x,e.y+e.z/2))<e.z/5?nameLine="N3":int(dist((x02-tox)/ratio,(y02-toy)/ratio,e.x-e.z/2,e.y))<e.z/5&&(nameLine="N4"),$("#modalCreateLinePoint").modal(),$("#requestLinePoint").text("Bạn Có muốn tạo quan hệ giữa điểm "+e.name+" hướng "+nameLine+" và "+pointName),mapName=e.name)}}if(keyIsDown(77)&&!imgTheme.linePoint&&!imgTheme.lineStatus&&!imgTheme.pointStatus&&!imgTheme.checkMap&&!imgTheme.status()&&!(mouseX>=1800&&mouseX<=widthImg-2&&mouseY>=0&&mouseY<=40)&&mouseX>0&&mouseY>0&&mouseX<1850&&mouseY<heightWin){for(let e of rectMap)e.check=!0;$("#errEditAll").hide(),$("#errEditCode").hide(),$("#errEditN1").hide(),$("#errEditN2").hide(),$("#errEditN3").hide(),$("#errEditN4").hide(),$("#errEditX").hide(),$("#errEditY").hide(),$("#errEditZ").hide(),$("#errEditXLida").hide(),$("#errEditYLida").hide(),$("#errEditXNav").hide(),$("#errEdityNav").hide(),$("#errEditLayout").hide(),$("#modalEdit").modal({backdrop:"static",keyboard:!1}),$("#rectName").val(imgTheme.name),$("#editLine").val(imgTheme.code),$("#xRect").val(((mouseX-tox)/ratio).toFixed(0)),$("#yRect").val(((mouseY-toy)/ratio).toFixed(0)),$("#zRect").val(imgTheme.z),$("#N1Rect").val(imgTheme.N1),$("#N2Rect").val(imgTheme.N2),$("#N3Rect").val(imgTheme.N3),$("#N4Rect").val(imgTheme.N4),$("#N5Rect").val(imgTheme.N5),$("#N0Rect").val(imgTheme.N0),$("#editLayout").val(imgTheme.layout),$("#editXLida").val(imgTheme.xLida),$("#editYLida").val(imgTheme.yLida),$("#editXNav").val(imgTheme.xNav),$("#editYNav").val(imgTheme.yNav),rectMap[imgTheme.position].updatePosition(ratio,tox,toy),rectMap[imgTheme.position].moveRect(),imgTheme.setCheckMap()}}3==dataName.length&&2!=linePointMove.length||(dataName=[],linePointMove=[])}function keyReleased(){if(statusConfig&&load_map)for(let e of rectMap)e.check=!0}function mouseDragged(){if(keyIsDown(90)&&load_map&&(tox+=mouseX-pmouseX,toy+=mouseY-pmouseY),statusConfig&&load_map){for(let e of rectMap)e.movePoint(ratio,tox,toy);if(imgTheme.lineStatus){x02=mouseX,y02=mouseY;for(let e of rectMap)e.setNewLine1()}}}function mouseWheel(e){if(load_map)return!(mouseX<widthImg-2&&mouseX>0&&mouseY>0&&mouseY<heightWin&&keyIsDown(90))||(-e.delta>0?ratio<20&&(ratio+=.1):ratio>.3&&(ratio+=-.1),!1)}function mouseClicked(){if(statusConfig&&load_map){if(mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=45&&mouseY<=80&&(imgTheme.resetMap(),imgTheme.resetPoint(),imgTheme.resetLinePoint(),imgTheme.setLineStatus()),mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=0&&mouseY<=40&&!keyIsDown(90)&&(imgTheme.resetLine(),imgTheme.resetPoint(),imgTheme.resetLinePoint(),imgTheme.setMapStatus()),imgTheme.status()&&!(mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=0&&mouseY<=124)&&!keyIsDown(90)){let e=((mouseX-tox)/ratio).toFixed(0),t=((mouseY-toy)/ratio).toFixed(0),o=$.ajax({method:"get",url:window.location.origin+"/agv-control/create-map",cache:!1,data:{x:e,y:t,layout:$("#layoutAgv").val()},dataType:"json"});o.done(function(e){let t,o;1==e.data[0].NAME.length?(t=.65,o=.8):2==e.data[0].NAME.length?(t=1.25,o=.8):3==e.data[0].NAME.length?(t=1.85,o=.8):(t=2.3,o=.8),test=new PointMap(Number(e.data[0].X),Number(e.data[0].Y),Number(e.data[0].Z),e.data[0].NAME,t,o,0,0,0,0,0,0,0,rectMap.length-1,Number(e.data[0].X_LIDA),Number(e.data[0].Y_LIDA),Number(e.data[0].X_NAV),Number(e.data[0].Y_NAV),Number(e.data[0].Layout)),rectMap.push(test),$("#mapName").append('<option class=" sele my-sel'+e.data[0].Layout+" del"+e.data[0].NAME+'" value='+e.data[0].NAME+">"+e.data[0].NAME+"</option>")}),o.fail(function(e){console.log(e)})}mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=84&&mouseY<=124&&!keyIsDown(90)&&(imgTheme.resetMap(),imgTheme.resetLine(),imgTheme.resetLinePoint(),imgTheme.statusAddPoint()),!imgTheme.addPoint||mouseX>=widthImg-45&&mouseX<=widthImg-2&&mouseY>=0&&mouseY<=124||keyIsDown(90)||($("#modalEditLayoutPoint").modal(),imgTheme.statusAddPoint(),$("#xPoint").val(((mouseX-tox)/ratio).toFixed(0)),$("#yPoint").val(((mouseY-toy)/ratio).toFixed(0)),$("#idPoint").text("0"),$("#namePoint").val(0),$("#mapName").val(0),$("#angle").val(0),$("#offset").val(0),$("#hPoint").val(15),$("#wPoint").val(15),$("#revPoint").val(0),$("#areaPoint").val(0),$("#partitionPoint").val(0),$("#masterAgvTypePoint").val(0),$("#code").val(0),$(".select-layout").val($("#layoutAgv").val()))}}function doubleClicked(){if(statusConfig&&load_map){if(imgTheme.resetLine(),imgTheme.resetPoint(),imgTheme.resetMap(),imgTheme.resetLinePoint(),!imgTheme.lineStatus)for(let e of rectMap)e.showModal(ratio,tox,toy);selectLine=[];for(let e of lineMap)e.statusPointLine()&&selectLine.push(e);for(let e of pointList)!set&&e.check&&($("#errAll").hide(),$("#errNamePoint").hide(),$("#errMapNamePoint").hide(),$("#errAngle").hide(),$("#errOffset").hide(),$("#errX").hide(),$("#errY").hide(),$("#errH").hide(),$("#errW").hide(),$("#errRev").hide(),$("#errArea").hide(),$("#errPartition").hide(),$("#errType").hide(),$("#errCode").hide(),$("#modalEditLayoutPoint").modal(),$("#idPoint").text(e.id),$("#namePoint").val(e.name),$("#mapName").val(e.mapName),$("#angle").val(e.angle),$("#offset").val(e.offset),$("#xPoint").val(e.x),$("#yPoint").val(e.y),$("#hPoint").val(e.h),$("#wPoint").val(e.w),$("#revPoint").val(e.rev),$("#areaPoint").val(e.area),$("#partitionPoint").val(e.partition),$("#masterAgvTypePoint").val(e.type),$("#code").val(e.code),$(".select-layout").val($("#layoutAgv").val()));if(0!=selectLine.length){$("#modalEditLine").modal(),$("#loadingEditLine").hide(),$("#N1").hide(),$("#N2").hide(),$("#N3").hide(),$("#N4").hide(),$("#N13").hide(),$("#N24").hide(),$("#N1").css({"background-color":"white"}),$("#N2").css({"background-color":"white"}),$("#N3").css({"background-color":"white"}),$("#N4").css({"background-color":"white"}),$("#N13").css({"background-color":"white"}),$("#N24").css({"background-color":"white"}),$("#nameN1").text(""),$("#nameN2").text(""),$("#nameN3").text(""),$("#nameN4").text(""),$("#nameN13").text(""),$("#nameN24").text("");for(let e of selectLine)"N1"==e.typ?($("#N1").show(),$("#N3").show(),$("#N1").css({"background-color":"yellow"}),$("#nameN1").text(e.name),$("#nameN3").text(e.to)):"N3"==e.typ&&($("#N3").show(),$("#N1").show(),$("#N3").css({"background-color":"yellow"}),$("#nameN3").text(e.name),$("#nameN1").text(e.to)),"N2"==e.typ?($("#N2").show(),$("#N4").show(),$("#N2").css({"background-color":"yellow"}),$("#nameN2").text(e.name),$("#nameN4").text(e.to)):"N4"==e.typ&&($("#N4").show(),$("#N2").show(),$("#N4").css({"background-color":"yellow"}),$("#nameN4").text(e.name),$("#nameN2").text(e.to)),"N13"==e.typ&&($("#N13").show(),$("#nameN13").text(e.name),$("#N13").css({"background-color":"yellow"})),"N24"==e.typ&&($("#N24").show(),$("#nameN24").text(e.name),$("#N24").css({"background-color":"yellow"}))}else $("#N1").css({"background-color":"white"}),$("#N2").css({"background-color":"white"}),$("#N3").css({"background-color":"white"}),$("#N4").css({"background-color":"white"})}}function mouseMoved(){if(statusConfig&&load_map){for(let e of rectMap)e.movePoint(ratio,tox,toy);for(let e of lineMap)e.clickedLine(ratio,tox,toy);for(let e of pointList)e.moveMousePoint(ratio,tox,toy);imgTheme.moveMap(),imgTheme.moveLineMap(),imgTheme.movePoint(),imgTheme.moveLinePoint()}}function updatePoi(e){return $.ajax({method:"get",url:window.location.origin+"/agv-control/map/update-point",cache:!1,data:e,dataType:"json"})}function updateLine(e){return $("#loadingEditLine").show(),$.ajax({method:"get",url:window.location.origin+"/agv-control/map/update-line",cache:!1,data:e,dataType:"json"})}function updateLayoutPoint(e){return $("#loadingEditLine").show(),$.ajax({method:"get",url:window.location.origin+"/agv-control/update-layout-point",cache:!1,data:e,dataType:"json"})}function updateAllLayoutPoint(e){return $("#loadingEditLine").show(),$.ajax({method:"get",url:window.location.origin+"/agv-control/update-all-layout-point",cache:!1,data:e,dataType:"json"})}function line_save(){$("#loadingInsertLine").show(),name1=dataName[0],"N1"==dataName[1]?dataUpdateLine={name:name1,N1:dataName[2],N2:"",N3:"",N4:""}:"N2"==dataName[1]?dataUpdateLine={name:name1,N1:"",N2:dataName[2],N3:"",N4:""}:"N3"==dataName[1]?dataUpdateLine={name:name1,N1:"",N2:"",N3:dataName[2],N4:""}:"N4"==dataName[1]&&(dataUpdateLine={name:name1,N1:"",N2:"",N3:"",N4:dataName[2]}),updateLine(dataUpdateLine).done(function(e){console.log(e),$("#modalCreateLine").modal("hide"),$("#loadingInsertLine").hide(),loadData(),loadPoint($("#layoutAgv").val())}).fail(function(e){console.log(e),$("#loadingInsertLine").hide()}),dataName=[],data1=[];for(let e of rectMap)e.resetLine()}$("#saveEdit").on("click",function(){let e={name:$("#rectName").val(),code:$("#editLine").val(),layout:$("#editLayout").val(),x:$("#xRect").val(),y:$("#yRect").val(),z:$("#zRect").val(),N1:$("#N1Rect").val(),N2:$("#N2Rect").val(),N3:$("#N3Rect").val(),N4:$("#N4Rect").val(),x_lida:$("#editXLida").val(),y_lida:$("#editYLida").val(),x_nav:$("#editXNav").val(),y_nav:$("#editYNav").val()};""==e.code||""==e.x||""==e.y||""==e.z||""==e.N1||""==e.N2||""==e.N3||""==e.N4||""==e.x_lida||""==e.y_lida||""==e.x_nav||""==e.y_nav||""==e.layout?($("#errEditAll").show(),""==e.code?$("#errEditCode").show():$("#errEditCode").hide(),""==e.x?$("#errEditX").show():$("#errEditX").hide(),""==e.y?$("#errEditY").show():$("#errEditY").hide(),""==e.z?$("#errEditZ").show():$("#errEditZ").hide(),""==e.N1?$("#errEditN1").show():$("#errEditN1").hide(),""==e.N2?$("#errEditN2").show():$("#errEditN2").hide(),""==e.N3?$("#errEditN3").show():$("#errEditN3").hide(),""==e.N4?$("#errEditN4").show():$("#errEditN4").hide(),""==e.x_lida?$("#errEditXLida").show():$("#errEditXLida").hide(),""==e.y_lida?$("#errEditYLida").show():$("#errEditYLida").hide(),""==e.x_nav?$("#errEditXNav").show():$("#errEditXNav").hide(),""==e.y_nav?$("#errEditYNav").show():$("#errEditYNav").hide(),""==e.layout?$("#errEditLayout").show():$("#errEditLayout").hide()):($("#loadingEditPoint").show(),updatePoi(e).done(function(e){loadData(),loadPoint($("#layoutAgv").val()),$("#loadingEditPoint").hide(),$("#modalEdit").modal("hide")}).fail(function(e){$("#loadingEditPoint").hide(),console.log(e)}))}),$("#closeEdit").on("click",function(){for(let e of rectMap)e.returnPosition()}),$("#btnClose").on("click",function(){for(let e of rectMap)e.returnPosition()}),$("#delLayoutPoint").on("click",function(){$("#modalEditLayoutPoint").modal("hide"),$("#namePointRequest").text($("#namePoint").val()),$("#modalRequestDelPoint").modal(),$("#loadingDeletePoint").hide(),$("#point").text($("#namePoint").val())}),$("#deletePoint").on("click",function(){$("#loadingDeletePoint").show(),$.ajax({method:"get",url:window.location.origin+"/agv-control/map/delete-point",cache:!1,data:{_token:$('meta[name="csrf-token"]').attr("content"),id:$("#idPoint").text()},dataType:"json"}).done(function(e){console.log(e),$("#modalRequestDelPoint").modal("hide"),$("#loadingDeletePoint").hide(),loadData(),loadPoint($("#layoutAgv").val())}).fail(function(e){console.log(e)})}),$("#deleteEdit").on("click",function(){$("#modalEdit").modal("hide"),$("#modalRequest").modal(),$("#loadingDelete").hide(),$("#map").text($("#rectName").val())}),$("#deleteSave").on("click",function(){$("#loadingDelete").show();var e=$.ajax({method:"get",url:window.location.origin+"/agv-control/map/delete-map",cache:!1,data:{name:$("#rectName").val()},dataType:"json"});e.done(function(e){$("#modalRequest").modal("hide"),$("#loadingDelete").hide(),$(".del"+$("#rectName").val()).remove(),loadData(),loadPoint($("#layoutAgv").val())}),e.fail(function(e){console.log(e),$("#loadingDelete").hide()})}),$("#N1").on("click",function(){"rgb(255, 255, 0)"==$("#N1").css("background-color")?$("#N1").css({"background-color":"white"}):$("#N1").css({"background-color":"yellow"})}),$("#N3").on("click",function(){"rgb(255, 255, 0)"==$("#N3").css("background-color")?$("#N3").css({"background-color":"white"}):$("#N3").css({"background-color":"yellow"})}),$("#N2").on("click",function(){"rgb(255, 255, 0)"==$("#N2").css("background-color")?$("#N2").css({"background-color":"white"}):$("#N2").css({"background-color":"yellow"})}),$("#N4").on("click",function(){"rgb(255, 255, 0)"==$("#N4").css("background-color")?$("#N4").css({"background-color":"white"}):$("#N4").css({"background-color":"yellow"})}),$("#N13").on("click",function(){"rgb(255, 255, 0)"==$("#N13").css("background-color")?$("#N13").css({"background-color":"white"}):$("#N13").css({"background-color":"yellow"})}),$("#N24").on("click",function(){"rgb(255, 255, 0)"==$("#N24").css("background-color")?$("#N24").css({"background-color":"white"}):$("#N24").css({"background-color":"yellow"})}),$("#saveLine").on("click",function(){let e=N2=N3=N4=0,t=name2=0;if("rgb(255, 255, 0)"==$("#N1").css("background-color")){updateLine({name:t=$("#nameN1").text(),N1:e=$("#nameN3").text(),N2:"",N3:"",N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}else if("rgb(255, 255, 255)"==$("#N1").css("background-color")&&"none"!=$("#N1").css("display")){updateLine({name:t=$("#nameN1").text(),N1:0,N2:"",N3:"",N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}if("rgb(255, 255, 0)"==$("#N3").css("background-color")){t=$("#nameN3").text(),N3=$("#nameN1").text(),updateLine({name:t,N1:"",N2:"",N3:N3,N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}else if("rgb(255, 255, 255)"==$("#N3").css("background-color")&&"none"!=$("#N3").css("display")){updateLine({name:t=$("#nameN3").text(),N1:"",N2:"",N3:0,N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}if("rgb(255, 255, 0)"==$("#N2").css("background-color")){t=$("#nameN2").text(),N2=$("#nameN4").text(),updateLine({name:t,N1:"",N2:N2,N3:"",N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}else if("rgb(255, 255, 255)"==$("#N2").css("background-color")&&"none"!=$("#N2").css("display")){updateLine({name:t=$("#nameN2").text(),N1:"",N2:0,N3:"",N4:""}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}if("rgb(255, 255, 0)"==$("#N4").css("background-color")){t=$("#nameN4").text(),N4=$("#nameN2").text(),updateLine({name:t,N1:"",N2:"",N3:"",N4:N4}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}else if("rgb(255, 255, 255)"==$("#N4").css("background-color")&&"none"!=$("#N4").css("display")){updateLine({name:t=$("#nameN4").text(),N1:"",N2:"",N3:"",N4:0}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide()}).fail(function(e){console.log(e)})}if("rgb(255, 255, 255)"==$("#N13").css("background-color")&&"none"!=$("#N13").css("display")){updateLayoutPoint({name:t=$("#nameN13").text()}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide(),loadPoint($("#layoutAgv").val())}).fail(function(e){console.log(e)})}if("rgb(255, 255, 255)"==$("#N24").css("background-color")&&"none"!=$("#N24").css("display")){updateLayoutPoint({name:t=$("#nameN24").text()}).done(function(e){$("#modalEditLine").modal("hide"),$("#loadingEditLine").hide(),loadPoint($("#layoutAgv").val())}).fail(function(e){console.log(e)})}loadData()}),$("#lineSave").on("click",function(){line_save()}),$(document).keyup(function(e){13==e.keyCode&&"none"!=$("#modalCreateLine").css("display")&&line_save()}),$("#lineCLose").on("click",function(){data1=[],dataName=[],x01=y01=x02=y02=0;for(let e of rectMap)e.resetLine()}),$("#saveLayoutPoint").on("click",function(){let e={id:$("#idPoint").text(),name:$("#namePoint").val(),mapName:$("#mapName").val(),angle:$("#angle").val(),offset:$("#offset").val(),x:$("#xPoint").val(),y:$("#yPoint").val(),h:$("#hPoint").val(),w:$("#wPoint").val(),rev:$("#revPoint").val(),area:$("#areaPoint").val(),partition:$("#partitionPoint").val(),type:$("#masterAgvTypePoint").val(),code:$("#code").val(),layout:$(".select-layout").val()};console.log(e),""==e.name||""==e.angle||""==e.offset||""==e.x||""==e.y||""==e.h||""==e.w||""==e.rev||"0"==e.area||"0"==e.partition||0==e.type||""==e.code?($("#errAll").show(),""==e.name?$("#errNamePoint").show():$("#errNamePoint").hide(),"0"==e.mapName?$("#errMapNamePoint").show():$("#errMapNamePoint").hide(),""==e.angle?$("#errAngle").show():$("#errAngle").hide(),""==e.offset?$("#errOffset").show():$("#errOffset").hide(),""==e.x?$("#errX").show():$("#errX").hide(),""==e.y?$("#errY").show():$("#errY").hide(),""==e.h?$("#errH").show():$("#errH").hide(),""==e.w?$("#errW").show():$("#errW").hide(),""==e.rev?$("#errRev").show():$("#errRev").hide(),0==e.area?$("#errArea").show():$("#errArea").hide(),0==e.partition?$("#errPartition").show():$("#errPartition").hide(),0==e.type?$("#errType").show():$("#errType").hide(),0==e.code?$("#errCode").show():$("#errCode").hide()):($("#loadingEditLayoutPoint").show(),updateAllLayoutPoint(e).done(function(e){$("#loadingEditLayoutPoint").hide(),$("#modalEditLayoutPoint").modal("hide"),$(".pointLocation"+$("#idPoint").text()).text($("#namePoint").val()),loadData(),loadPoint($("#layoutAgv").val())}).fail(function(e){$("#loadingEditLayoutPoint").hide(),console.log(e)}))}),$("#btnClosePoint").on("click",function(){for(let e of pointList)e.resetPoint()}),$("#linePointSave").on("click",function(){$("#loadingInsertLinePoint").show(),$.ajax({method:"get",url:window.location.origin+"/agv-control/update-line-point",data:{name:pointName,mapName:mapName,angle:nameLine},dataType:"json"}).done(function(e){loadData(),loadPoint($("#layoutAgv").val()),$("#modalCreateLinePoint").modal("hide"),$("#loadingInsertLinePoint").hide()}).fail(function(e){$("#loadingInsertLinePoint").hide(),console.log(e),linePointMove=[]})}),$("#btnClosePoint").on("click",function(){for(let e of pointList)e.resetPoint()});